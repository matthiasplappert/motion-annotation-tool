function webglAvailable(){try{var e=document.createElement("canvas");return!!window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl"))}catch(r){return!1}}function initViewer(e,r,t,n){r=r||!1,t=t||new THREE.Vector3(15,15,15),n=n||new THREE.Vector3(0,0,10),$.getJSON(e,function(e){if($("#motion-loading").hide(),!webglAvailable()){var a=document.createElement("div");return a.id="webgl-error-message",a.innerHTML=window.WebGLRenderingContext?["Your graphics card does not seem to support WebGL.",'Find out how to get it <a href="http://get.webgl.org/">here</a>.'].join("\n"):["Your browser does not seem to support WebGL.",'Find out how to get it <a href="http://get.webgl.org/">here</a>.'].join("\n"),void $("#motion").append(a)}$("#motion-container").show(),data=e,looping=r,initUi(),initScene(t,n),initLights(),initFloor(),initMarkers(),updateMarkers(),render()})}function initUi(){window.setInterval(updateFrameIndexIfNecessary,data.interval),$("#motion-ui-slider").attr({max:data.frames.length-1,min:0}),$("#motion-ui-slider").bind("mousedown",function(){update_slider=!1,$("#motion-ui-slider").bind("mousemove",function(){playing=!1,frame_idx=parseInt($("#motion-ui-slider").val()),updateButton()})}),$("#motion-ui-slider").bind("mouseup",function(){$("#motion-ui-slider").val(frame_idx),update_slider=!0,$("#motion-ui-slider").unbind("mousemove")}),updateButton(),$("#motion-ui-button").click(function(){playing=!playing,playing&&frame_idx==data.frames.length-1&&(frame_idx=0),updateButton()})}function updateButton(){playing?$("#motion-ui-button").val("Pause"):$("#motion-ui-button").val("Play")}function initScene(e,r){targetElement=document.getElementById("motion-content"),scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(75,targetElement.offsetWidth/targetElement.offsetHeight,.001,1e3),camera.up.set(0,0,1),camera.position.x=e.x,camera.position.y=e.y,camera.position.z=e.z;var t={antialias:!0,alpha:!0};renderer=new THREE.WebGLRenderer(t),renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(targetElement.offsetWidth,targetElement.offsetHeight),renderer.setClearColor(0,0),targetElement.appendChild(renderer.domElement),controls=new THREE.OrbitControls(camera,renderer.domElement),controls.enableZoom=!0,controls.enablePan=!1,controls.target=r,controls.keys=[],controls.update(),window.addEventListener("resize",function(){camera.aspect=targetElement.offsetWidth/targetElement.offsetHeight,camera.updateProjectionMatrix(),renderer.setSize(targetElement.offsetWidth,targetElement.offsetHeight)},!1)}function updateTargetPositionIfAppropriate(){var e=controls.object.position.sub(controls.target),r=positionOfMarker("STRN"),t=(new THREE.Vector3).copy(r).add(e);controls.target=r,controls.object.position.copy(t),controls.update()}function vectorToString(e){return"("+e.x+","+e.y+","+e.z+")"}function assert(e,r){if(!e)throw r||"Assertion failed"}function initLights(){ambientLight=new THREE.AmbientLight(16777215),scene.add(ambientLight)}function initFloor(){for(var e=16,r=new THREE.PlaneGeometry(200,200,e,e),t=new THREE.MeshBasicMaterial({color:6908265}),n=new THREE.MeshBasicMaterial({color:10461087}),a=[t,n],o=0;e>o;o++)for(var d=0;e>d;d++)i=o*e+d,j=2*i,r.faces[j].materialIndex=r.faces[j+1].materialIndex=(o+d)%2;floor=new THREE.Mesh(r,new THREE.MeshFaceMaterial(a)),scene.add(floor)}function markerIndexFromName(e){for(var r in data.markers)if(data.markers[r]==e)return r;return-1}function positionOfMarker(e){for(var r in data.markers)if(data.markers[r]==e){data.frames[frame_idx][r];return new THREE.Vector3(data.frames[frame_idx][3*r],data.frames[frame_idx][3*r+1],data.frames[frame_idx][3*r+2])}return-1}function initMarkers(){var e=data.markers.length,r=data.marker_set;r||(r="kit"),markers=[];for(var t=0;e>t;t++){var n=new THREE.SphereGeometry(.1,32,32),a=new THREE.MeshBasicMaterial({color:65280}),i=new THREE.Mesh(n,a);markers.push(i),scene.add(i)}lines=[],marker_line_mapping=[];for(var o in marker_connections[r])for(var d in marker_connections[r][o])if(end_marker_name=marker_connections[r][o][d],start_idx=markerIndexFromName(o),end_idx=markerIndexFromName(end_marker_name),!(start_idx<0||end_idx<0)){var a=new THREE.LineBasicMaterial({color:255,linewidth:2}),n=new THREE.Geometry;n.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,0));var s=new THREE.Line(n,a);s.frustumCulled=!1,s.dynamic=!0,lines.push(s),marker_line_mapping.push([start_idx,end_idx]),scene.add(s)}}function updateMarkers(){for(var e=0;e<markers.length;e++){var r=markers[e];r.position.x=data.frames[frame_idx][3*e+0],r.position.y=data.frames[frame_idx][3*e+1],r.position.z=data.frames[frame_idx][3*e+2]}for(var e in lines)mapping=marker_line_mapping[e],start_marker=markers[mapping[0]],end_marker=markers[mapping[1]],line=lines[e],line.geometry.vertices=[start_marker.position,end_marker.position],line.geometry.verticesNeedUpdate=!0}function render(){requestAnimationFrame(render),frame_idx!=prev_frame_idx&&(updateTargetPositionIfAppropriate(),updateMarkers()),renderer.render(scene,camera),prev_frame_idx=frame_idx}function updateFrameIndexIfNecessary(){playing&&(looping||frame_idx<data.frames.length-1)&&(frame_idx=(frame_idx+1)%data.frames.length),looping||frame_idx!=data.frames.length-1||(playing=!1,updateButton()),update_slider&&$("#motion-ui-slider").val(frame_idx)}var scene,camera,renderer,controls,ambientLight,lights,data,update_slider=!0,markers,lines,marker_line_mapping,marker_connections={kit:{LFHD:["RFHD","LBHD"],RBHD:["RFHD","LBHD"],C7:["RFHD","LBHD","RBHD","LFHD","CLAV","LSHO","RSHO"],STRN:["CLAV","RASI","LASI"],T10:["LSHO","RSHO"],L3:["LPSI","RPSI","T10"],LUPA:["LSHO","LAEL"],LAEL:["LFRA"],LFRA:["LWTS"],LWPS:["LHPS","LWTS"],LHTS:["LWTS","LIFD"],LHPS:["LIFD"],RUPA:["RSHO","RAEL"],RAEL:["RFRA"],RFRA:["RWTS"],RWPS:["RHPS","RWTS"],RHTS:["RWTS","RIFD"],RHPS:["RIFD"],LHIP:["LASI","LPSI"],LTHI:["LHIP"],LKNE:["LTHI","LTIP"],LHEE:["LTIP","LANK","LMT1"],LMT5:["LANK","LTOE"],LMT1:["LTOE"],RHIP:["RASI","RPSI"],RTHI:["RHIP"],RKNE:["RTHI","RTIP"],RHEE:["RTIP","RANK","RMT1"],RMT5:["RANK","RTOE"],RMT1:["RTOE"]},cmu:{LFHD:["RFHD","LBHD"],RBHD:["RFHD","LBHD"],C7:["RFHD","LBHD","RBHD","LFHD","CLAV","LSHO","RSHO"],STRN:["CLAV","RFWT","LFWT"],T10:["LSHO","RSHO","LBWT","RBWT"],LBWT:["RBWT"],LUPA:["LSHO","LELB"],LELB:["LFRM"],LFRM:["LWRA","LWRB"],LFIN:["LWRA","LWRB"],RUPA:["RSHO","RELB"],RELB:["RFRM"],RFRM:["RWRA","RWRB"],RFIN:["RWRA","RWRB"],LTHI:["LFWT","LBWT"],LKNE:["LTHI","LSHN"],LHEE:["LSHN","LANK"],LMT5:["LANK","LTOE"],LANK:["LTOE"],RTHI:["RFWT","RBWT"],RKNE:["RTHI","RSHN"],RHEE:["RSHN","RANK"],RMT5:["RANK","RTOE"],RANK:["RTOE"]}},frame_idx=0,prev_frame_idx=-1,playing=!0,looping=!1;